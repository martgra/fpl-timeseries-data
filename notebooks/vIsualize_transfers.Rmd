---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.6.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
from fpl.data.cosmos import ElementsInserter
from dotenv import load_dotenv
import os
```

```{python}
load_dotenv()
cosmos = ElementsInserter(
    os.getenv("AZURE_COSMOS_URI"),
    os.getenv("AZURE_COSMOS_TOKEN"),
    {"database": "fplstats", "container": "elements", "partition_key": "download_time"},
)
```

```{python}
net_transfer = cosmos.search_db("SELECT c.web_name, c.download_time, (c.transfers_in - c.transfers_out) AS diff from c")
#net_transfer = cosmos.search_db("SELECT VALUE SUM(c.transfers_in) from c group by c.download_time")

```

```{python}
import pandas as pd
df = pd.DataFrame(net_transfer)
df2 = df
df.set_index("web_name")


df =pd.pivot_table(df,index="web_name",columns=df['download_time'].values, values="diff")
df.columns.tolist()
stripped_values = list([i[:16] for i in df.columns])
df.columns = stripped_values
df

df.to_csv("./table.csv")
```

```{python}
len(stripped_values)
```

```{python}
import seaborn as sns
import matplotlib.pyplot as plt
sns.set_theme(style="darkgrid")
plt.rcParams['figure.figsize'] = [12, 8]
plt.rcParams['figure.dpi'] = 100

# Plot the responses for different events and regions
chart = sns.lineplot(x="download_time", y="diff", data=df2, hue="web_name", legend="auto")
xticks=chart.xaxis.get_major_ticks()
for i in range(len(xticks)):
    if i%5==0:
        xticks[i].set_visible(False)

plt.xticks(rotation=90)
plt.title('seaborn-matplotlib example')
plt.show()
```

```{python}

```
